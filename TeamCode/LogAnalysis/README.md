# Log Analysis Tools

This folder contains Python and PowerShell scripts to analyze robot performance logs (CSV format) generated by the `DataLogger`. These tools help you tune PID controllers and derive Feedforward coefficients mathematically.

## 1. Setup & Installation

### Prerequisites
1.  **Install Python**: Download and install Python 3.x from [python.org](https://www.python.org/downloads/).
    *   *Note: During installation, check the box "Add Python to PATH".*
2.  **Verify Installation**: Open a terminal (PowerShell or Command Prompt) and run:
    ```powershell
    python --version
    ```

### Install Dependencies
Open a terminal in this folder (`TeamCode/LogAnalysis`) and run:
```powershell
pip install -r requirements.txt
```
*If that fails, try:* `python -m pip install -r requirements.txt`

---

## 2. Scripts & Usage

### A. `fetch_logs.ps1`
Downloads CSV log files from the Control Hub to your local computer.

**Prerequisites:**
*   **ADB (Android Debug Bridge)**: Must be installed and in your PATH. This usually comes with Android Studio.

**Usage:**
```powershell
.\fetch_logs.ps1
```
*   Connect your computer to the Control Hub via Wi-Fi or USB.
*   Logs will be saved to the current directory (or `logs/` folder if configured).

for mac, use command line
```shell
adb pull /sdcard/FIRST/data/logs .
```
to pull logs

### B. `clean_logs.ps1`
Deletes all log files from the Control Hub (Internal Storage & SD Card) to free up space.

**Usage:**
```powershell
.\clean_logs.ps1
```
*   **Device Selection:** If multiple devices are connected (e.g., Control Hub via USB and Wi-Fi), the script will list them and ask you to select one.
*   Scans for log directories.
*   Prompts for confirmation before deleting files.
*   Use `.\clean_logs.ps1 -Force` to skip confirmation.

### C. `analyze_pid.py`
**Purpose:** Visualizes PID performance to help you tune `kP`, `kI`, and `kD`. It calculates metrics like Overshoot and Settling Time.
**Best for:** Step Response tests (e.g., instantly setting target velocity from 0 to 1000).

**Usage:**
```powershell
# Analyze a specific file
python analyze_pid.py "path/to/log.csv"

# Analyze the latest log file automatically
python analyze_pid.py

# Save the plot as an image and open it (Recommended if window freezes)
python analyze_pid.py --save
```

**Interpreting Results:**
*   **RMSE (Root Mean Square Error):** The average error over time. Lower is better.
*   **Overshoot %:** How much the motor exceeds the target velocity.
    *   *> 5-10%*: System is too aggressive. **Decrease kP** or **Increase kD**.
*   **Settling Time:** How long it takes to stabilize.
    *   *Slow (> 1s)*: System is sluggish. **Increase kP** or tune Feedforward (`kV`).
*   **Steady-State Error:** The error remaining after the system settles.
    *   *Non-zero*: **Increase kI** or adjust `kV`/`kS`.

### D. `derive_coefficients.py`
**Purpose:** Performs System Identification (Linear Regression) to mathematically derive the physical Feedforward coefficients (`kS`, `kV`, `kA`) for your motors.
**Best for:** Ramp Tests (slowly accelerating from 0 to max speed) or Quasistatic tests.

**Usage:**
```powershell
# Derive coefficients from a specific file
python derive_coefficients.py "path/to/log.csv"

# Save the plot as an image and open it
python derive_coefficients.py --save
```

**Interpreting Results:**
The script outputs three coefficients:
1.  **kS (Static Friction):** The power required just to break static friction and start moving.
2.  **kV (Velocity Constant):** The power required to maintain a specific velocity (Power per TPS).
3.  **kA (Acceleration Constant):** The power required to accelerate (Power per TPS²).

**R² (Fit Quality):**
*   **Close to 1.0 (e.g., > 0.8):** The model fits the data well. The coefficients are reliable.
*   **Low (e.g., < 0.5):** The data is noisy or doesn't cover enough range (e.g., constant speed only). **Run a "Ramp Test"** (slowly accelerating from 0 to max speed) for better results.

---

## 3. Workflow Example

1.  **Run a Test:** Drive the robot or run a specific mechanism test (e.g., Shooter PID test) to generate a log.
2.  **Fetch Logs:**
    ```powershell
    .\fetch_logs.ps1
    ```
3.  **Analyze PID:** Check if the tuning is good.
    ```powershell
    python analyze_pid.py --save
    ```
4.  **Refine Tuning:**
    *   If you need better Feedforward, run `derive_coefficients.py` on a ramp test log.
    *   Update the constants in your Java code (`Shooter.java` or `DriveConstants.java`).
    *   Repeat.
